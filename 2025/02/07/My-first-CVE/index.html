<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ContextThe backstory on this event was that my friend Firdaus recently was awarded CVE-2024-21544 in the browsershot package. I was amazed and reached out to know more as CVE hunting was never on my m">
<meta property="og:type" content="article">
<meta property="og:title" content="My first CVE">
<meta property="og:url" content="https://chuajianshen.github.io/2025/02/07/My-first-CVE/index.html">
<meta property="og:site_name" content="Shen">
<meta property="og:description" content="ContextThe backstory on this event was that my friend Firdaus recently was awarded CVE-2024-21544 in the browsershot package. I was amazed and reached out to know more as CVE hunting was never on my m">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://chuajianshen.github.io/2025/02/07/My-first-CVE/poc.png">
<meta property="og:image" content="https://chuajianshen.github.io/2025/02/07/My-first-CVE/trim.png">
<meta property="article:published_time" content="2025-02-07T08:10:10.000Z">
<meta property="article:modified_time" content="2025-02-07T08:56:19.241Z">
<meta property="article:author" content="Shen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chuajianshen.github.io/2025/02/07/My-first-CVE/poc.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/puck.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/puck.ico" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/puck.ico">
        
      
    
    <!-- title -->
    <title>My first CVE</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/02/07/OSWE-2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chuajianshen.github.io/2025/02/07/My-first-CVE/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&text=My first CVE"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&is_video=false&description=My first CVE"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=My first CVE&body=Check out this article: https://chuajianshen.github.io/2025/02/07/My-first-CVE/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&name=My first CVE&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&t=My first CVE"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context"><span class="toc-number">1.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reporting"><span class="toc-number">2.</span> <span class="toc-text">Reporting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Twist"><span class="toc-number">3.</span> <span class="toc-text">Twist</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        My first CVE
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Shen</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-02-07T08:10:10.000Z" class="dt-published" itemprop="datePublished">07-02-2025</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>The backstory on this event was that my friend <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/firdaus-amran/">Firdaus</a> recently was awarded <a target="_blank" rel="noopener" href="https://security.snyk.io/vuln/SNYK-PHP-SPATIEBROWSERSHOT-8496745">CVE-2024-21544</a> in the <a target="_blank" rel="noopener" href="https://github.com/spatie/browsershot">browsershot</a> package. I was amazed and reached out to know more as CVE hunting was never on my mind as it seemed too daunting. He shared to not limit yourself and just try, which got me motivated to just do it.</p>
<p>I then peeked at the latest package version and noticed that it still seemed vulnerable - which was the case and the birth of <a target="_blank" rel="noopener" href="https://security.snyk.io/vuln/SNYK-PHP-SPATIEBROWSERSHOT-8501858">CVE-2024-21547</a>. Essentially, this package converts a webpage to an image or pdf with the help of headless chrome (a browser). Users can pass in URLs such as “<a target="_blank" rel="noopener" href="https://google.com/">https://google.com</a>“ and it would render it as an image&#x2F;pdf.</p>
<p>The developer introduced certain checks to ensure that local file reads were not possible. The code responsible is shown below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public function setUrl(string $url): static</span><br><span class="line">    &#123;</span><br><span class="line">        $url = trim($url);</span><br><span class="line"></span><br><span class="line">        if (str_starts_with(strtolower($url), &#x27;file://&#x27;) || str_starts_with(strtolower($url), &#x27;file:/&#x27;)) &#123;</span><br><span class="line">            throw FileUrlNotAllowed::make();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $this-&gt;url = $url;</span><br><span class="line">        $this-&gt;html = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">        return $this;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>However, it only ensures that the URL does not start with “file:&#x2F;&#x2F;“ or “file:&#x2F;“. As the URL would be fed into headless chrome, the developer did not account for browser normalisation. An example payload “file:\&#x2F;etc&#x2F;passwd” can be used to read the local passwd file if this package is used on the internet and accepts user input. When the browser receives “file\\&#x2F;etc&#x2F;passwd”, it would be normalised to the regular “file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd”.</p>
<p>A local PoC is given as :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">require_once &#x27;vendor/autoload.php&#x27;;</span><br><span class="line"></span><br><span class="line">use Spatie\Browsershot\Browsershot;</span><br><span class="line"></span><br><span class="line">Browsershot::url(&#x27;file:\\\\/etc/passwd&#x27;)-&gt;newHeadless()-&gt;save(&quot;./test.pdf&quot;);</span><br></pre></td></tr></table></figure>

<img src="/2025/02/07/My-first-CVE/poc.png" class="" title="poc">


<h2 id="Reporting"><a href="#Reporting" class="headerlink" title="Reporting"></a>Reporting</h2><p>After emailing the security vendor as mentioned on their GitHub, I filled in a form by <a target="_blank" rel="noopener" href="https://snyk.io/vulnerability-disclosure/">Snyk</a> to facilitate the CVE disclosure process. After patching the vulnerability and pushing it to GitHub, Snyk awarded the CVE.</p>
<h2 id="Twist"><a href="#Twist" class="headerlink" title="Twist"></a>Twist</h2><p>After looking at the patched code, I then was also curious at Firdaus’s CVE and took a look at the <a target="_blank" rel="noopener" href="https://github.com/spatie/browsershot/commit/fae8396641b961f62bd756920b14f01a4391296e">fix</a> for it. It added the PHP <a target="_blank" rel="noopener" href="https://www.php.net/manual/en/function.trim.php">trim</a> function to prevent spaces or new lines in the URL which would also be normalised by the browser and bypass checks.</p>
<p>I read into the documentation and noticed that the trim function only strips whitespace from the beginning and end of the string. It does not remove characters from any other position.</p>
<img src="/2025/02/07/My-first-CVE/trim.png" class="" title="trim">

<p>As browsers are user friendly, they tend to normalise many characters to provide better user experience. I thought of putting the new line character (%0A) into the middle of the URL such as “file:<br>&#x2F;&#x2F;&#x2F;etc&#x2F;passwd” which actually works as it would be normalised.</p>
<p>Thus, <a target="_blank" rel="noopener" href="https://security.snyk.io/vuln/SNYK-PHP-SPATIEBROWSERSHOT-8533024">CVE-2025-1026</a> was born 💀.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context"><span class="toc-number">1.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reporting"><span class="toc-number">2.</span> <span class="toc-text">Reporting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Twist"><span class="toc-number">3.</span> <span class="toc-text">Twist</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chuajianshen.github.io/2025/02/07/My-first-CVE/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&text=My first CVE"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&is_video=false&description=My first CVE"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=My first CVE&body=Check out this article: https://chuajianshen.github.io/2025/02/07/My-first-CVE/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&title=My first CVE"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&name=My first CVE&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chuajianshen.github.io/2025/02/07/My-first-CVE/&t=My first CVE"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    Shen
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
